# A Simple Flask Template Project

## What-it-does

It's a basic flask framework for web developing projects.

Key functions are shown below:
- support restful developing using flask-restful
- support db management using flask-migrate
- support delay-task and schedules using celery
- support task and schedule monitor using flower with celery
- support cache using redis
- support test case using pytest

## Project Structure

- app: flask app
    - api: api route
    - config: app config
    - const: const fields
    - ext: flask extension
    - model: Mysql db model
    - schedule: celery schedule
    - task: celery task
    - util: common utilities
    - __init__.py: create and config app
    
- conf:
    - supervisor: supervisor conf
    - nginx: nginx conf

- migrations: version history auto-generated by alembic

- manage.py: interactive flask shell command && db management
    - `python manage.py shell`: Runs an ipython shell in current_app context with some pre-import modules.
    - `python manage.py run`: Run a flask-cli built-in development server.
    - `python manage.py routes`: Show the routes for current app.
    - `python manage.py db`: Runs a flask-migration cli command.
    - `python manage.py --help`: Runs a click help command.

- run_web.py: a script for run web in supervisor

- run_celery.py: a script for run celery in supervisor

- ...

## Installation

- download:
    - git clone.
- configure:
    - cp conf/supervisor/. /supervisord-conf-location (Then change directory in conf to where you clone this project).
    - configure nginx.
- sudo pipenv install
- start:
    - `supervisorctl update`: update conf and start all
    - `nginx -s reload`: update and reload nginx

## Monitor

All web, celery tasks and schedules running states are stored in `logs` file. So we can check the conf file and execute something like `tail -f /var/log/www/system_worker_error.log`.

Flower are running with default config so we can just hit `http://127.0.0.1:5555/` the Flower web page.

## Debug

`python manage.py` is a very useful tool for debugging and locating problems.

For temporarily running is `python manage.py run`.
For running a flask-app context is `python manage.py shell`. Then debug with the interactive shell command.
For listing flask-app routes is `python manage.py routes`.

## DB management

`python manage.py db`.

init: `python manage.py db init`, which generate `migrations` folder if not exists
migrate: `python manage.py db migrate` ...
upgrade: `python manage.py db upgrade` ...
downgrade: `python manage.py db downgrade` ...

see [Flask-Migrate Documentation](https://github.com/miguelgrinberg/Flask-Migrate)
